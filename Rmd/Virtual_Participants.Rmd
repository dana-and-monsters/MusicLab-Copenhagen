---
title: "Virtual_Participants"
author: "Dana Swarbrick"
date: "10/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Import libraries

```{r libraries}
packages = c("psych", "readxl", "magrittr", "reshape2","ggpubr", "ltm","janitor", "PerformanceAnalytics", "tidyverse")

## Now load or install&load all
package.check <- lapply(
  packages,
  FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE)
      library(x, character.only = TRUE)
    }
  }
)

source("useful_functions.R")
```

# Virtual Participants
## Import data

```{r dansk-files}
setwd('../experimental-data/surveys/')
filenames <- list.files(pattern="*Dansk.xlsx", full.names=TRUE)
ldf<-lapply(filenames, read_xlsx)
for (i in 1:length(ldf))
  assign(paste("dansk.df", i, sep=""), ldf[[i]])
```
```{r english-files}
setwd('../experimental-data/surveys/')
filenames <- list.files(pattern="*English.xlsx", full.names=TRUE)
ldf<-lapply(filenames, read_xlsx)
for (i in 1:length(ldf))
  assign(paste(paste("english.df", i, sep="")), ldf[[i]])
```

## Tidy & Rename
To avoid repeating everything 2x, will just combine english and danish surveys here. 

### Rename cols

#### Q1: Pre-concert Survey
```{r}
q1<-names(english.df1)
q1.dansk<-names(dansk.df1)
q1id<-c("NR", "userID", "city", "viewing_with_others", "age", "gender", "musician_status", "personal_relation", "fan", "EC_1", "EC_2", "EC_3", "EC_4", "EC_5", "EC_6", "EC_7","Elapsed_time")
codebook1<-cbind(q1id,q1, q1.dansk)

# Rename cols based on codes
names(english.df1)<-q1id
names(dansk.df1)<-q1id
```

#### Q2, Q3, Q5: After Beethoven, Schnittke, Folk
```{r}
q2<-names(english.df2)
q3<-names(english.df3)
q5<-names(english.df5)

q2.dansk<-names(dansk.df2)
q3.dansk<-names(dansk.df3)
q5.dansk<-names(dansk.df5)
```

##### Check to make sure that the questions actually are all the same and in the same order
```{r}
q2==q3
q2[q2!=q3]
q3[q2!=q3]
q3==q5
q3[q5!=q3]
q5[q5!=q3]

qtest<-data.frame(cbind(q2,q3,q5))
#Looks good - just one inconsistency in wording.
```
##### And in danish
```{r}
q2.dansk==q3.dansk
q2.dansk[q2.dansk!=q3.dansk]
q3.dansk[q2.dansk!=q3.dansk]
q3.dansk==q5.dansk
q3.dansk[q5.dansk!=q3.dansk]
q5.dansk[q5.dansk!=q3.dansk]
```
This shows that there are no discrepancies between the wording of the questions across the surveys.
##### List of question IDs
```{r}
q2id<-c("NR", 
        "userID",
        "tears",
        "chills",
        "warm_feeling",
        "choked_up",
        "refreshed",
        "welcoming",
        "closeness",
        "positive",
        "negative", 
        "tense",
        "relaxed",
        "alone",
        "untouched",
        "moved",
        "touched",
        "admiration",
        "presence_grand",
        "greater_than_myself",
        "jaw_drop",
        "gasped",
        "challenge_process",
        "hard_comprehend",
        "others_moved",
        "connected_musicians",
        "connected_audience_streaming",
        "connected_audience_attending",
        "enjoy",
        "familiar",
        "own_world",
        "absorbed_music",
        "daydream",
        "sense_time",
        "distracted",
        "attentive",
        "attention_others",
        "attention_sensations",
        "positively_transformed",
        "negatively_transformed",
        "aware_body",
        "aware_movement",
        "aware_others_moving",
        "Elapsed_time")
```

```{r}
codebook2<-cbind(q2id, q2) #don't need to repeat for 3 or 5
```

##### Rename cols in surveys
Since you checked, you can rename surveys q3 and q5 in the same way as well

```{r}
names(english.df2)<-q2id
names(english.df3)<-q2id
names(english.df5)<-q2id

#and danish
names(dansk.df2)<-q2id
names(dansk.df3)<-q2id
names(dansk.df5)<-q2id
```


#### Q4: Bach

```{r}
q4<-names(english.df4)
q4.dansk<-names(dansk.df4)
print(q4)
```
```{r}
q4id<-c("NR",
       "userID",
       "perceive",
       "instruments",
       "understanding",
       "augment",
       "disturb",
       "enhance", 
       "emotionally_moved",
       "familiar",
       "style", 
       "aware_body",
       "aware_movement",
       "aware_others_moving",
       "Elapsed_time")

codebook3<-cbind(q4id, q4, q4.dansk)

names(english.df4)<-q4id
names(dansk.df4)<-q4id
```

#### Q6: After Concert Survey
```{r}
q6<-names(english.df6)
q6.dansk<-names(dansk.df6)
```

```{r}
q6id<-c("NR",
       "userID",
       "phone_loc",
       "aware_recording",
       "changed_behaviour",
       "Engage_1",
      "Engage_2",
      "Engage_3",
      "Engage_4",
      "Vis_Stim_1",
      "Vis_Stim_2",
      "Vis_Stim_3",
      "Vis_Stim_4",
      "Absorb_1",
      "Absorb_2",
      "Absorb_3",
      "Absorb_4",
      "Touch_1",
      "Touch_2",
      "Touch_3",
      "Touch_4",
      "AIMS_1",
      "AIMS_2",
      "AIMS_3",
      "AIMS_4",
      "AIMS_5",
      "AIMS_6",
      "AIMS_7",
      "AIMS_8",
      "AIMS_9",
      "AIMS_10",
      "AIMS_11",
      "AIMS_12",
      "AIMS_13",
      "AIMS_14",
      "AIMS_15",
      "AIMS_16",
      "AIMS_17",
      "AIMS_18",
      "AIMS_19",
      "AIMS_20",
      "AIMS_21",
      "AIMS_22",
      "AIMS_23",
      "AIMS_24",
      "AIMS_25",
      "AIMS_26",
      "AIMS_27",
      "AIMS_28",
      "AIMS_29",
      "AIMS_30",
      "AIMS_31",
      "AIMS_32",
      "AIMS_33",
      "AIMS_34",
      "Comments",
      "Elapsed_time")

codebook4<-cbind(q6id, q6, q6.dansk)

names(english.df6)<-q6id
names(dansk.df6)<-q6id
```

### Label and combine English and Danish
```{r}
df.list = mget(paste0("english.df",1:6))
dfs.english = lapply(df.list, function(df) select(df,c(-"NR", -"Elapsed_time")))
df.list = mget(paste0("dansk.df",1:6))
dfs.dansk = lapply(df.list, function(df) select(df,c(-"NR", -"Elapsed_time")))

#explode list of dataframes to global vars
list2env(dfs.english,globalenv())
list2env(dfs.dansk,globalenv())

# add language to df1 (demographic info)
english.df1$language<-"English"
dansk.df1$language<-"Danish"

# Combine to larger dataframes
df1<-bind_rows(english.df1, dansk.df1)
df2<-bind_rows(english.df2, dansk.df2)
df3<-bind_rows(english.df3, dansk.df3)
df4<-bind_rows(english.df4, dansk.df4)
df5<-bind_rows(english.df5, dansk.df5)
df6<-bind_rows(english.df6, dansk.df6)

```
## Create a wide spreadsheet
### Label the repeated measures labels
```{r}
colnames(df2)[2:ncol(df2)]<-paste0(colnames(df2)[2:ncol(df2)], '_Beethoven')
colnames(df3)[2:ncol(df3)]<-paste0(colnames(df3)[2:ncol(df3)], '_Schnittke')
colnames(df5)[2:ncol(df5)]<-paste0(colnames(df5)[2:ncol(df5)], '_Folk')
```

### Combine into a wide spreadsheet
```{r}
df<-full_join(df1, df2, by ="userID")
df<-full_join(df, df3, by ="userID")
df<-full_join(df, df4, by ="userID")
df<-full_join(df, df5, by ="userID")
df<-full_join(df, df6, by ="userID")
```

## Data Cleaning
### Remove testing 
I believe that the first 5 rows are just garbage/testing from before the concert
```{r}
df<-df%>%slice(6:nrow(df))

## Remove duplicate rows
df<-df%>% distinct()

### Continue to find and remove duplicates
# 1) Find rows that have the same userID as another row
duplicates<-df%>%
  group_by(userID)%>%
  filter(n() > 1)
#2) Check how many NAs are in each duplicate row
duplicates$nacount<- rowSums( !is.na(duplicates))

#3) Choose the rows with the highest number of non-NAs
dedup<-duplicates%>%group_by(userID)%>%
  slice(which.max(nacount))

#4) Replace these rows in the original dataframe
df<-df%>%filter(!userID %in% duplicates$userID)
dedup<-dedup%>%select(-nacount) # remove the nacount col
df<-df%>%bind_rows(dedup)
```

# Live Participants

## Format table
What format do these need to be in to allow cbind with the virtual surveys?
```{r paper-surveys}
setwd('../experimental-data/')
paper<-read_xlsx("Data_Paper_Surveys.xlsx")
```

```{r}
headers<-paper[1,]
headers[1,15:54]<-lapply(headers[1,15:54], function(x) paste0(x,"_Beethoven"))
headers[1,55:94]<-lapply(headers[1,55:94], function(x) paste0(x,"_Schnittke"))
headers[1,107:146]<-lapply(headers[1,107:146], function(x) paste0(x,"_Folk"))

headers<-unlist(headers)

# keep organizing the new dataframe and then  a full join or inner join should work to reveal what is missing
setwd('../experimental-data/')
live.df<-read_xlsx("Data_Paper_Surveys.xlsx", sheet = 1, skip = 2, col_names = headers, col_types="text")

# convert "NA" to real NA
live.df[live.df=="NA"]=NA

# add language column
live.df<-live.df%>%
  mutate(language = ifelse(startsWith(ID, "DSQd"), "Danish", "English")) # check<-live.df%>%select(ID,language) # double checked and it works 

# prepare for factoring musician status --> when pts checked off multipleboxes, this was averaged but for categorizing them we need to put them into a single categoruy so we could simply round I guess...
live.df$musician_status<-as.character(round(as.numeric(live.df$musician_status), digits = 0)) # rounded the number to nearest whole number

```

## Conduct a join to see which col names need to be changed
Also import all cols as char to enable the join with the df.
```{r}
live.df$group<-"Live"
df$group<-"Virtual"

# Check for differences before joining
test.df<-compare_df_cols(live.df, df) # looks great! (this helped me catch the language col issue and some other things)
```



```{r}
df.full<-full_join(live.df, df)
```
## Translations and factor
Factor these vars so that it will convert the norsk to the english
```{r}
df.full$gender<-fct_collapse(df.full$gender, Man = c("Man", "Mand", "1"), Woman = c("Woman", "Kvinde", "2", Not_Identify = c("Choose not to Identify", "3"), Other = c("Other", "4") ))


df.full$musician_status<-fct_collapse(df.full$musician_status,"Tone-deaf" = c("1", "Tone-deaf", "Tonedøv"), "Nonmusician" = c("2", "Nonmusician", "Ikke-musiker"), "Music-loving nonmusician" = c("3", "Music-loving nonmusician", "Musikelskende ikke-musiker"), "Amateur musician" = c("4", "Amateur musician", "Amatørmusiker"), "Serious amateur musician" = c("5", "Serious amateur musician", "Seriøs amatørmusiker"), "Semiprofessional musician"= c("6", "Semiprofessional musician", "Semiprofessionel musiker"), "Professional musician" = c("7", "Professional musician", "Professionel musiker"))

df.full$personal_relation<-fct_collapse(df.full$personal_relation, No_Relation = c("0","I don’t have any particular relation to them", "Jeg har ikke nogen bestemt relation"), Relative_Friend = c("1", "I am a relative/friend", "Jeg er en ven/familie"))

# factor aware_body
df.full<-df.full%>%mutate_at(vars(matches("aware_body")), function(x){fct_collapse(x, "Not at all" = c("1", "Not at all"), "Rarely" = c("2", "Rarely", "Sjældent"), "Intermittently" = c("3", "Intermittently", "Fra tid til anden"), "Continuously" = c("4", "Continuously", "Hele tiden"))})
check<-df.full%>%select(matches("aware_body"))

# factor aware_movement
df.full<-df.full%>%mutate_at(vars(matches("aware_movement")), function(x){fct_collapse(x, "Not aware of movement" = c("1", "Not aware of movement", "Ikke opmærksom på bevægelse"),"Yes and I moved less than usual"= c("2", "Yes and I moved less than usual", "Ja, og jeg bevægede mig mindre end normalt"), "Yes and I moved a normal amount" = c("3", "Yes and I moved a normal amount", "Ja, og jeg bevægede mig som jeg normalt ville have gjort"),"Yes and I moved more than usual" = c("4", "Yes and I moved more than usual", "Ja, og jeg bevægede mig mere end normalt"))})

# factor aware_others_moving
df.full<-df.full%>%mutate_at(vars(matches("aware_others_moving")), function(x){fct_collapse(x, "Not aware of others' movement" = c("1", "Not aware of others&#39; movement", "Ikke opmærksom på andres bevægelse"),"Yes and they moved less than usual"= c("2", "Yes and they moved less than usual"), "Yes and they moved a normal amount" = c("3", "Yes and they moved a normal amount", "Ja, og de bevægede sig som de normalt ville have gjort"),"Yes and they moved more than usual" = c("4", "Yes and they moved more than usual"))})

```

## Pre-processing

### Numeric
```{r}
# Make a list of any responses that are not entirely numeric and convert to numeric by extracting the first character and then converting to numeric
firstnum<-function(x) (str_sub(x, end = 1))
```

Convert numeric cols to numeric
```{r}
dfNum<-df.full%>%select(
  fan:EC_7, 
  tears_Beethoven:negatively_transformed_Beethoven,
  tears_Schnittke:negatively_transformed_Schnittke, 
  perceive:style,
  tears_Folk:negatively_transformed_Folk,
  aware_recording:changed_behaviour,
  Engage_1:Touch_4, # because I need to extract first number and factor both dfs together
  AIMS_1:AIMS_34,
  connected_audience_streaming_Beethoven:connected_audience_attending_Folk)%>%
  mutate(across(everything(),firstnum))%>%
  mutate(across(everything(),as.numeric))
#NAs introduced by coercion error message because some Pts wrote letters into the age category

df.full[names(dfNum)]<-dfNum

df.full<-df.full%>%
  mutate(age = as.numeric(age))
```

### Factor
Convert factor cols to factor
```{r}
dfFac<-df.full%>%select(
  userID:viewing_with_others, 
  gender:personal_relation, 
  aware_body_Beethoven:aware_others_moving_Beethoven,
  aware_body_Schnittke:aware_others_moving_Schnittke,
  aware_body:aware_others_moving,
  aware_body_Folk:aware_others_moving_Folk,
  phone_loc)

dfFac<-dfFac%>%mutate_all(factor)

df.full[names(dfFac)]<-dfFac
```

### Create combined measures
Go through the surveys and create the combined measures including:
* empathic concern 
* Kama Muta 
* awe scale
* Absorption Scale - unclear how to analyze it because it is unclear what is considered high absorption versus low
* AIMS

#### Empathic Concern Scale
Note: I checked the reverse scoring in both the paper survey and the online survey and it is correct. The order of questions in this survey was slightly different from the Quarantine Concerts experiment.
```{r}
EC<-df.full%>%select(EC_1, EC_2, EC_3, EC_4, EC_5, EC_6, EC_7)

# reverse score the reversed items
columnsToReverse<-c("EC_2","EC_4","EC_5")
EC_R<-EC # make duplicate to check reverse scoring with
EC_R[,columnsToReverse]<-6-EC_R[,columnsToReverse]

# check alpha
summary(psych::alpha(EC_R))$raw_alpha

#create avg value
df.full$EC<-rowMeans(EC_R, na.rm=TRUE)
```

#### AIMS
Info on AIMS: https://smartlaboratory.org/resources/aims-scale/
All items are worded in a positive direction so none need to be reversed.
```{r}
AIMS<-df.full%>%
  select(contains("AIMS"))

summary(psych::alpha(AIMS))$raw_alpha

df.full$AIMS<-rowMeans(AIMS, na.rm=TRUE)
```

#### Kama Muta Scale (KAMMUS-S US)
The International Kama Muta scale was validated across 19 countries and includes the KAMMUS-2, a 22-24 item scale, instead of the 50 item version (Zickfeld, 2019).
The authors recommend that the scores of the 5 aspects should not be averaged but instead, a high score across all 5 aspects would be indicative of people experiencing this distinct social-relational emotion. However, Beate Seibt, expert on Kama Muta suggested doing a reliability analysis across all items of the short scale and averaging them if the reliability score was satisfactory.

The 5 Aspects of Being Moved Experiences are:
1. Physical sensations
2. Appraisal patterns
3. Motivation or action tendencies (telling care and wanting hug were not included because they did not seem relevant for the classical music concert context)
4. Valence
5. Labels (words used to describe kama muta - vary by culture/language. e.g. English: being moved or being touched)

##### Compute for 3 pieces
Note: could not use the "contains" short cut because "untouched" and "others_moved" were being selected as well.
```{r}
#Beethoven
KM_Beethoven<-df.full%>%
  select(tears_Beethoven:positive_Beethoven, moved_Beethoven:touched_Beethoven)

print(summary(psych::alpha(KM_Beethoven))$raw_alpha)
  
df.full$KM_Beethoven<-rowMeans(KM_Beethoven, na.rm=TRUE)

# Schnittke
KM_Schnittke<-df.full%>%
  select(tears_Schnittke:positive_Schnittke, moved_Schnittke:touched_Schnittke)

print(summary(psych::alpha(KM_Schnittke))$raw_alpha)
  
df.full$KM_Schnittke<-rowMeans(KM_Schnittke, na.rm=TRUE)

# FOlk
KM_Folk<-df.full%>%
  select(tears_Folk:positive_Folk, moved_Folk:touched_Folk)

print(summary(psych::alpha(KM_Folk))$raw_alpha)
  
df.full$KM_Folk<-rowMeans(KM_Folk, na.rm=TRUE)

```

#### Awe Scale
The awe experience scale items (AWE-S; Yaden et al., 2019) we used were the two highest loading items from the subscales of perceived vastness, physical sensations, and need for accommodation:
*Perceived Vastness*
- I felt that I was in the presence of something grand.
- I experienced something greater than myself.
*Physical sensations*
- I felt my jaw drop.
- I gasped.
*Accomodation*
- I felt challenged to mentally process what I was experiencing.
- I found it hard to comprehend the experience in full.

The items have the qIDs:
- "presence_grand", 
- "greater_than_myself",
- "jaw_drop",
- "gasped",
- "challenge_process",
- "hard_comprehend",


```{r}
#Beethoven
AWE<-df.full%>%
  select(contains("Beethoven"))%>%
  select(contains(c("presence_grand", "greater_than_myself", "jaw_drop", "gasped", "challenge_process", "hard_comprehend")))

print(summary(psych::alpha(AWE))$raw_alpha)

df.full$AWE_Beethoven<-rowMeans(AWE, na.rm=TRUE)

#Schnittke
AWE<-df.full%>%
  select(contains("Schnittke"))%>%
  select(contains(c("presence_grand", "greater_than_myself", "jaw_drop", "gasped", "challenge_process", "hard_comprehend")))

print(summary(psych::alpha(AWE))$raw_alpha)

df.full$AWE_Schnittke<-rowMeans(AWE, na.rm=TRUE)

#Folk
AWE<-df.full%>%
  select(contains("Folk"))%>%
  select(contains(c("presence_grand", "greater_than_myself", "jaw_drop", "gasped", "challenge_process", "hard_comprehend")))

print(summary(psych::alpha(AWE))$raw_alpha)

df.full$AWE_Folk<-rowMeans(AWE, na.rm=TRUE)
```

# Visualizations 
Try KM and EC correlation, etc. Let's make some charts to test expected correlations.

### Are EC and KM related, as expected?
There were no significant correlations in the virtual audience (n = 67) but there were significant correlations with the live audience (n = 91).
```{r}
df.full%>%count(group)

df.full%>%
  filter(group == "Live")%>%
  select(EC, contains('KM'))%>%
  chart.Correlation(method = "kendall")

df.full%>%
  filter(group == "Virtual")%>%
  select(EC, contains('KM'))%>%
  chart.Correlation(method = "kendall")

```
###  Beethoven
```{r}
df.full%>%
  filter(group =="Live")%>%
  select(EC, KM_Beethoven,connected_musicians_Beethoven,connected_audience_Beethoven, fan)%>%
  chart.Correlation(method = "kendall")


df.full%>%
  filter(group=="Virtual")%>%
  select(EC, KM_Beethoven,connected_musicians_Beethoven,connected_audience_streaming_Beethoven, connected_audience_attending_Beethoven, fan)%>%
  chart.Correlation(method = "kendall")
```
###  Schnittke
```{r}
df.full%>%
  filter(group =="Live")%>%
  select(EC, KM_Schnittke,connected_musicians_Schnittke,connected_audience_Schnittke, fan )%>%
  chart.Correlation(method = "kendall")

df.full%>%
  filter(group == "Virtual")%>%
  select(EC, KM_Schnittke,connected_musicians_Schnittke,connected_audience_streaming_Schnittke, connected_audience_attending_Schnittke, fan )%>%
  chart.Correlation(method = "kendall")
```

###  Folk
```{r}
df.full%>%
  filter(group =="Live")%>%
  select(EC, KM_Folk,connected_musicians_Folk,connected_audience_Folk, fan )%>%
  chart.Correlation(method = "kendall")

df.full%>%
  filter(group == "Virtual")%>%
  select(EC, KM_Folk,connected_musicians_Folk,connected_audience_streaming_Folk, connected_audience_attending_Folk, fan )%>%
  chart.Correlation(method = "kendall")
```

## Cross-correlation
```{r}
colours_DSQ<-c("#2d769a", "white","#b34036")
```

### Beethoven 
Especially examine absorption's relation to other things. Remove vars that are represented in other vars like KM vars, AWE, and vars that are not numeric like the awareness ones. 
#### Live
```{r}
corData<-df.full%>% # without including the KM vars, awe vars, and aware vars
  filter(group == "Live")%>%
  select(EC, fan, group, contains('Beethoven'))%>%
  select(-contains(c('tears','chills','warm_feeling','choked_up','refreshed','welcoming','closeness','moved','touched')))%>% # remove kama muta vars except for  "positive" because I want to see the positive versus negative association and I don't want to remove the positively transformed one. 
  select(-contains(c('presence_grand','greater_than_myself','jaw_drop','gasped','challenge_process','hard_comprehend')))%>%
  select(-contains('aware'))%>%# because these are factors (but could actually be converted to ordinal)
  select(-contains('connected')) # because the connected measure needs to be re-worked a little

#select only complete
corData<-na.omit(corData)

# check number of samples
samples<-nrow(corData)

title = "Beethoven-Live"
subtitle = paste0("Kendall Correlations (BH adj) (n = ", samples, ")")
cross.correlation(corData, colours_DSQ, title, subtitle) #moved the cross-correlation code to the useful_functions script to make this more tidy.

graphname<-paste0("../plots/Kendall-Correlations-", title, ".png")
ggsave(graphname, 
       width = 10, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

#### Virtual 
```{r}
corData<-df.full%>% # without including the KM vars, awe vars, and aware vars
  filter(group == "Virtual")%>% # UPDATE
  select(EC, fan, group, contains('Beethoven'))%>% # UPDATE
  select(-contains(c('tears','chills','warm_feeling','choked_up','refreshed','welcoming','closeness','moved','touched')))%>% # remove kama muta vars except for  "positive" because I want to see the positive versus negative association and I don't want to remove the positively transformed one. 
  select(-contains(c('presence_grand','greater_than_myself','jaw_drop','gasped','challenge_process','hard_comprehend')))%>%
  select(-contains('aware'))%>%# because these are factors (but could actually be converted to ordinal)
  select(-contains('connected')) # because the connected measure needs to be re-worked a little

#select only complete
corData<-na.omit(corData)

# check number of samples
samples<-nrow(corData)

title = "Beethoven-Virtual" # UPDATE
subtitle = paste0("Kendall Correlations (BH adj) (n = ", samples, ")")
cross.correlation(corData, colours_DSQ, title, subtitle) #moved the cross-correlation code to the useful_functions script to make this more tidy.

graphname<-paste0("../plots/Kendall-Correlations-", title, ".png")
ggsave(graphname, 
       width = 10, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```


### Schnittke
#### Live
```{r}
corData<-df.full%>% # without including the KM vars, awe vars, and aware vars
  filter(group == "Live")%>%
  select(EC, fan, group, contains('Schnittke'))%>%
  select(-contains(c('tears','chills','warm_feeling','choked_up','refreshed','welcoming','closeness','moved','touched')))%>% # remove kama muta vars except for  "positive" because I want to see the positive versus negative association and I don't want to remove the positively transformed one. 
  select(-contains(c('presence_grand','greater_than_myself','jaw_drop','gasped','challenge_process','hard_comprehend')))%>%
  select(-contains('aware'))%>%# because these are factors (but could actually be converted to ordinal)
  select(-contains('connected')) # because the connected measure needs to be re-worked a little

#select only complete
corData<-na.omit(corData)

# check number of samples
samples<-nrow(corData)

title = "Schnittke-Live"
subtitle = paste0("Kendall Correlations (BH adj) (n = ", samples, ")")
cross.correlation(corData, colours_DSQ, title, subtitle) #moved the cross-correlation code to the useful_functions script to make this more tidy.

graphname<-paste0("../plots/Kendall-Correlations-", title, ".png")
ggsave(graphname, 
       width = 10, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

#### Virtual 
```{r}
corData<-df.full%>% # without including the KM vars, awe vars, and aware vars
  filter(group == "Virtual")%>% # UPDATE
  select(EC, fan, group, contains('Schnittke'))%>% # UPDATE
  select(-contains(c('tears','chills','warm_feeling','choked_up','refreshed','welcoming','closeness','moved','touched')))%>% # remove kama muta vars except for  "positive" because I want to see the positive versus negative association and I don't want to remove the positively transformed one. 
  select(-contains(c('presence_grand','greater_than_myself','jaw_drop','gasped','challenge_process','hard_comprehend')))%>%
  select(-contains('aware'))%>%# because these are factors (but could actually be converted to ordinal)
  select(-contains('connected')) # because the connected measure needs to be re-worked a little

#select only complete
corData<-na.omit(corData)

# check number of samples
samples<-nrow(corData)

title = "Schnittke-Virtual" # UPDATE
subtitle = paste0("Kendall Correlations (BH adj) (n = ", samples, ")")
cross.correlation(corData, colours_DSQ, title, subtitle) #moved the cross-correlation code to the useful_functions script to make this more tidy.

graphname<-paste0("../plots/Kendall-Correlations-", title, ".png")
ggsave(graphname, 
       width = 10, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

### Folk
#### Live
```{r}
corData<-df.full%>% # without including the KM vars, awe vars, and aware vars
  filter(group == "Live")%>%
  select(EC, fan, group, contains('Folk'))%>%
  select(-contains(c('tears','chills','warm_feeling','choked_up','refreshed','welcoming','closeness','moved','touched')))%>% # remove kama muta vars except for  "positive" because I want to see the positive versus negative association and I don't want to remove the positively transformed one. 
  select(-contains(c('presence_grand','greater_than_myself','jaw_drop','gasped','challenge_process','hard_comprehend')))%>%
  select(-contains('aware'))%>%# because these are factors (but could actually be converted to ordinal)
  select(-contains('connected')) # because the connected measure needs to be re-worked a little

#select only complete
corData<-na.omit(corData)

# check number of samples
samples<-nrow(corData)

title = "Folk-Live"
subtitle = paste0("Kendall Correlations (BH adj) (n = ", samples, ")")
cross.correlation(corData, colours_DSQ, title, subtitle) #moved the cross-correlation code to the useful_functions script to make this more tidy.

graphname<-paste0("../plots/Kendall-Correlations-", title, ".png")
ggsave(graphname, 
       width = 10, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

#### Virtual 
```{r}
corData<-df.full%>% # without including the KM vars, awe vars, and aware vars
  filter(group == "Virtual")%>% # UPDATE
  select(EC, fan, group, contains('Folk'))%>% # UPDATE
  select(-contains(c('tears','chills','warm_feeling','choked_up','refreshed','welcoming','closeness','moved','touched')))%>% # remove kama muta vars except for  "positive" because I want to see the positive versus negative association and I don't want to remove the positively transformed one. 
  select(-contains(c('presence_grand','greater_than_myself','jaw_drop','gasped','challenge_process','hard_comprehend')))%>%
  select(-contains('aware'))%>%# because these are factors (but could actually be converted to ordinal)
  select(-contains('connected')) # because the connected measure needs to be re-worked a little

#select only complete
corData<-na.omit(corData)

# check number of samples
samples<-nrow(corData)

title = "Folk-Virtual" # UPDATE
subtitle = paste0("Kendall Correlations (BH adj) (n = ", samples, ")")
cross.correlation(corData, colours_DSQ, title, subtitle) #moved the cross-correlation code to the useful_functions script to make this more tidy.

graphname<-paste0("../plots/Kendall-Correlations-", title, ".png")
ggsave(graphname, 
       width = 10, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

## Prelim Bach Visualization findings
```{r}
Title = "Visualization_Items"

dat<-df.full%>%
  select(EC, group, fan, perceive:style)

c<-dat%>%
  group_by(group)%>%
  count()

Subtitle = paste0("n live = ", c$n[c$group =="Live"], "; n virtual = ", c$n[c$group =="Virtual"])

dat_long<-dat%>%
  pivot_longer(!c(EC, group, fan), names_to = "question", values_to = "response")

dat_long%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_boxplot()+
  labs(title=Title,
       subtitle = Subtitle)#+
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1)+
  #geom_boxplot(width = 0.1, fill = "white")

graphname<-paste0("../plots/",Title, ".png")
ggsave(graphname, 
       width = 20, 
       height = 9, 
       units = 'cm', 
       dpi = 500)

dat_long%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_violin()+
  labs(title=Title,
       subtitle = Subtitle)#+
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1)+
  #geom_boxplot(width = 0.1, fill = "white")

graphname<-paste0("../plots/Violin_",Title, ".png")
ggsave(graphname, 
       width = 30, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

## Prelim absorption findings

```{r}

absorb.items<-c("own_world", "absorbed_music", "daydream", "sense_time", "distracted", "attentive", "attention_others","attention_sensations", "transformed")

absorb<-df.full%>%
  select(group, contains(absorb.items))

absorb.long<-absorb%>%pivot_longer(!group,
                        names_to = c("question", "piece"),
                        names_pattern ="(.*)_(.*)",
                        values_to = "response")
```

### Beethoven
```{r}
Title = "Absorption_Beethoven"

absorb.beethoven<-absorb.long%>%
  filter(piece == "Beethoven")

c<-absorb.beethoven%>%
  group_by(group)%>%
  count()

Subtitle = paste0("n live = ~", round(c$n[c$group =="Live"]/length(absorb.items),1), "; n virtual = ~", round(c$n[c$group =="Virtual"]/length(absorb.items),1))
# round because decimal because sometimes people didn't answer every question. There should be a way to get a better estimate of this btw, for example including ids and then counting the number of unique IDs.

absorb.beethoven%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_boxplot()+
  labs(title=Title,
       subtitle = Subtitle)#+

graphname<-paste0("../plots/",Title, ".png")
ggsave(graphname, 
       width = 20, 
       height = 9, 
       units = 'cm', 
       dpi = 500)

absorb.beethoven%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_violin()+
  labs(title=Title,
       subtitle = Subtitle)#+
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1)+
  #geom_boxplot(width = 0.1, fill = "white")

graphname<-paste0("../plots/Violin_",Title, ".png")
ggsave(graphname, 
       width = 30, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

### Schnittke
```{r}
Title = "Absorption_Schnittke"

absorb.schnittke<-absorb.long%>%
  filter(piece == "Schnittke")

c<-absorb.schnittke%>%
  group_by(group)%>%
  count()

Subtitle = paste0("n live = ~", round(c$n[c$group =="Live"]/length(absorb.items),1), "; n virtual = ~", round(c$n[c$group =="Virtual"]/length(absorb.items),1))
# round because decimal because sometimes people didn't answer every question. There should be a way to get a better estimate of this btw, for example including ids and then counting the number of unique IDs.

absorb.schnittke%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_boxplot()+
  labs(title=Title,
       subtitle = Subtitle)#+

graphname<-paste0("../plots/",Title, ".png")
ggsave(graphname, 
       width = 20, 
       height = 9, 
       units = 'cm', 
       dpi = 500)

absorb.schnittke%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_violin()+
  labs(title=Title,
       subtitle = Subtitle)#+
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1)+
  #geom_boxplot(width = 0.1, fill = "white")

graphname<-paste0("../plots/Violin_",Title, ".png")
ggsave(graphname, 
       width = 30, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```


### Folk
```{r}
Title = "Absorption_Folk"

absorb.folk<-absorb.long%>%
  filter(piece == "Folk")

c<-absorb.folk%>%
  group_by(group)%>%
  count()

Subtitle = paste0("n live = ~", round(c$n[c$group =="Live"]/length(absorb.items),1), "; n virtual = ~", round(c$n[c$group =="Virtual"]/length(absorb.items),1))
# round because decimal because sometimes people didn't answer every question. There should be a way to get a better estimate of this btw, for example including ids and then counting the number of unique IDs.

absorb.folk%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_boxplot()+
  labs(title=Title,
       subtitle = Subtitle)#+

graphname<-paste0("../plots/",Title, ".png")
ggsave(graphname, 
       width = 20, 
       height = 9, 
       units = 'cm', 
       dpi = 500)

absorb.folk%>%ggplot(aes(fill = group,x = question, y = response))+
  geom_violin()+
  labs(title=Title,
       subtitle = Subtitle)#+
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1)+
  #geom_boxplot(width = 0.1, fill = "white")

graphname<-paste0("../plots/Violin_",Title, ".png")
ggsave(graphname, 
       width = 30, 
       height = 9, 
       units = 'cm', 
       dpi = 500)
```

## SOMETHING IS WRONG WITH THE COUNTING AND SUBTITLE! TRY TO FIX!